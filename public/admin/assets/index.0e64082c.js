import{aO as h,z as g,r as o,y as c,u as he,a as w,j as l,x as P,B as O,aP as B,M as u,a2 as fe,n as x,q as pe,m as be}from"./index.0701407b.js";import{D as ge}from"./index.05bebaa5.js";import{I as L}from"./index.324d6103.js";import{C as Ce}from"./index.fe066c67.js";import{C as Te}from"./index.3a74b4d9.js";import{T as Se}from"./index.f9c32a55.js";import{P as ve}from"./index.71c84a1d.js";import{U as we}from"./index.166d5954.js";import{i as xe,S as ye,s as V}from"./form.900ff599.js";import{getColumns as Fe}from"./constants.ffa10078.js";import"./b-tween.es.064e2a03.js";import"./index.04ef67da.js";import"./index.b2ceac5c.js";import"./index.2a3c6e10.js";import"./pad.c33466c1.js";import"./index.1f328959.js";import"./index.f8e60d27.js";import"./index.692427e2.js";import"./index.78cc22b7.js";function Ie(r){return h({url:"/website/query",method:"post",data:r})}function ke(){return h({url:"/category/query",method:"post"})}function _e(r){return h({url:"/website/create",method:"post",data:r})}function Le(r){return h({url:"/website/delete",method:"post",data:r})}function Ve(r){return h({url:"/website/update",method:"post",data:r})}function Ne(r){return h({url:"/website/enable",method:"post",data:r})}function Ue(r){return h({url:"/website/disable",method:"post",data:r})}const De=g.Search,{Text:A}=be;function Ze(){const[r,M]=o.exports.useState([]),[N,R]=o.exports.useState([]),U=o.exports.useRef(N);U.current=N;const[W,f]=o.exports.useState(!1),[q,y]=o.exports.useState(!1),[j,C]=o.exports.useState(!1),[F,T]=o.exports.useState(""),[I,S]=o.exports.useState(""),[n]=c.useForm(),t=he(xe),[d,k]=o.exports.useState({sizeCanChange:!0,showTotal:!0,pageSize:10,current:1,pageSizeChangeResetCurrent:!0}),[D,J]=o.exports.useState({}),[K,Y]=o.exports.useState([]);function $(e){switch(e){case"MANUAL":return"\u624B\u52A8\u521B\u5EFA";case"COLLECTION":return"\u7528\u6237\u6536\u5F55";case"IMPORT":return"\u4E66\u7B7E\u5BFC\u5165";case"CLOUD_SYNC":return"\u4E91\u7AEF\u540C\u6B65";default:return"\u624B\u52A8\u521B\u5EFA"}}const G=async(e,a)=>{if(a=="check"&&(Y([{label:t["searchTable.columns.websiteName"],value:l(A,{copyable:!0,children:e.website_name})},{label:t["searchTable.columns.url"],value:l(A,{copyable:!0,children:e.url})},{label:t["searchTable.columns.category"],value:e.category},{label:t["searchTable.columns.iconUrl"],value:l(L,{width:20,height:20,src:e.icon_url})},{label:t["searchTable.columns.icon"],value:l(L,{width:20,height:20,src:e.icon})},{label:t["searchTable.columns.description"],value:e.description},{label:t["searchTable.columns.rating"],value:e.rating},{label:t["searchTable.columns.clickCount"],value:e.click_count},{label:t["searchTable.columns.checkCount"],value:e.check_count},{label:t["searchTable.columns.lastCheckTime"],value:e.last_check_time},{label:t["searchTable.columns.offlineCount"],value:e.offline_count},{label:t["searchTable.columns.offlineCountSubtotal"],value:e.offline_count_subtotal},{label:t["searchTable.columns.healthStatus"],value:e.health_status==1?l(x,{color:"green",children:t["searchTable.columns.healthStatus.enable"]}):l(x,{color:"red",children:t["searchTable.columns.healthStatus.disable"]})},{label:t["searchTable.columns.sort"],value:e.sort_index},{label:t["searchTable.columns.creationMethod"],value:$(e.creation_method)},{label:t["searchTable.columns.status"],value:e.status==1?l(x,{color:"green",children:t["searchTable.columns.status.enable"]}):l(x,{color:"red",children:t["searchTable.columns.status.disable"]})},{label:t["searchTable.columns.createdTime"],value:e.created_at},{label:t["searchTable.columns.updatedTime"],value:e.updated_at}]),y(!0)),a=="edit"){T(e.uuid);let i="";i=""+e.icon,e.pid=e.cid;const s=E(e,U.current);s.length!=0&&n.setFieldValue("cid",s),n.setFieldValue("websiteName",e.website_name),n.setFieldValue("url",e.url),n.setFieldValue("sortIndex",e.sort_index),n.setFieldValue("iconUrl",e.icon_url),n.setFieldValue("rating",e.rating),n.setFieldValue("description",e.description),n.setFieldValue("status",e.status===1);const p=e.icon?[{uid:e.id,url:i,response:{data:{name:e.icon.replace("/media/image?n=",""),path:e.icon}}}]:[];n.setFieldValue("icon",p),S(e.icon_url),f(!0)}a=="changeStatus"&&(T(e.uuid),ie(e.uuid,e.status)),a=="delete"&&le(e.uuid)},H=o.exports.useMemo(()=>Fe(t,G),[t]),[Q,X]=o.exports.useState([]),[Z,v]=o.exports.useState(!0),[ee,_]=o.exports.useState(!1);o.exports.useEffect(()=>{m()},[d.current,d.pageSize,JSON.stringify(D)]),o.exports.useEffect(()=>{te()},[]);function te(){ke().then(e=>{const a=e.data.list;R(a);const i=ae(a);M(i)})}function m(){const{current:e,pageSize:a}=d;v(!0),Ie({page:e,pageSize:a,...D}).then(i=>{X(i.data.pageData),k({...d,current:e,pageSize:a,total:i.data.total}),v(!1)})}function E(e,a){let i=[];const s=a.find(p=>p.id===e.pid);return s&&(i=[...E(s,a),s.id]),i}function ae(e){const a={},i=[];return e.forEach(s=>{a[s.id]={...s,children:[]}}),e.forEach(s=>{var p;if(s.pid!="0"){const b=a[s.pid];b&&(b.label=b.name,b.value=b.id,a[s.id].label=a[s.id].name,a[s.id].value=a[s.id].id,(p=b.children)==null||p.push(a[s.id]))}else a[s.id].label=a[s.id].name,a[s.id].value=a[s.id].id,i.push(a[s.id])}),i}function le(e){v(!0),Le({uuid:e}).then(a=>{a.data.code===0?m():u.error(a.data.message)})}function ie(e,a){v(!0),a=="1"?Ue({uuid:e}).then(i=>{i.data.code===0?m():u.error(i.data.message)}):Ne({uuid:e}).then(i=>{i.data.code===0?m():u.error(i.data.message)})}function se(e){_(!0),pe.get("/api/open/website/parse?url="+e).then(a=>{const i=a.data.data;n.setFieldValue("websiteName",i.title),n.setFieldValue("description",i.description),n.setFieldValue("iconUrl",i.icon),S(i.icon),_(!1)})}function ne(e){return e[e.length-1]}function oe(e){C(!0),e.cid=e.cid==null?0:e.cid,e.cid.length>0&&(e.cid=ne(e.cid)),e.icon=e.icon&&e.icon.length!==0?typeof e.icon[0].response=="string"?JSON.parse(e.icon[0].response).data.name:e.icon[0].response.data.name:void 0,e.iconUrl=I,e.status=e.status?"true":"false",F?Ve({uuid:F,...e}).then(a=>{a.data.code===0?(u.success(t["form.submitSuccess"]),m(),f(!1),z()):u.error(a.data.message),C(!1)}):_e({...e}).then(a=>{a.data.code===0?(u.success(t["form.submitSuccess"]),f(!1),m(),z()):u.error(a.data.message),C(!1)})}function z(){f(!1),C(!1),n.resetFields()}function re(){T(""),f(!0),S(""),_(!1),n.setFieldValue("sortIndex","1")}const ce={labelCol:{span:4},wrapperCol:{span:20}};function ue({current:e,pageSize:a}){k({...d,current:e,pageSize:a})}function de(e){k({...d,current:1}),e.time!=""&&e.time!=null&&(e.startTime=e.time[0],e.endTime=e.time[1],delete e.time),e.lastCheckTime!=""&&e.lastCheckTime!=null&&(e.lastCheckStartTime=e.lastCheckTime[0],e.lastCheckEndTime=e.lastCheckTime[1],delete e.time),J(e)}const me=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5]))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);return w("div",{children:[w(Te,{children:[l(ye,{onSearch:de,categoryData:r}),l(ve,{children:w("div",{className:V["button-group"],children:[l(P,{children:l(O,{onClick:()=>{re()},type:"primary",children:t["searchTable.operations.add"]})}),l(P,{children:l(O,{onClick:()=>{m()},type:"primary",children:t["searchTable.operations.reload"]})})]})}),l(Se,{rowKey:"id",loading:Z,onChange:ue,pagination:d,columns:H,data:Q})]}),l(B,{width:400,title:F?t["drawer.title.edit"]:t["drawer.title.add"],visible:W,confirmLoading:j,okText:t["form.button.text"],onOk:()=>{n.validate().then(e=>{oe(e)})},onCancel:()=>{T(""),f(!1),C(!1),n.resetFields()},children:w(c,{...ce,form:n,layout:"vertical",children:[l(c.Item,{label:t["form.url"],field:"url",rules:[{required:!0,message:t["form.url.placeholder"]}],children:l(De,{placeholder:t["form.url.placeholder"],searchButton:!0,loading:ee,onSearch:e=>{me(e)?se(e):u.error(t["form.parseUrl.error"])}})}),l(c.Item,{label:t["form.websiteName"],field:"websiteName",rules:[{required:!0,message:t["form.websiteName.placeholder"]}],children:l(g,{placeholder:t["form.websiteName.placeholder"]})}),l(c.Item,{label:t["form.category"],field:"cid",rules:[{required:!0,message:t["form.category.placeholder"]}],children:l(Ce,{placeholder:t["form.category.placeholder"],options:r,changeOnSelect:!0,allowClear:!0})}),l(c.Item,{label:t["form.description"],field:"description",children:l(g.TextArea,{className:V["arco-input"],placeholder:t["form.description.placeholder"]})}),l(c.Item,{label:t["form.iconUrl"],children:I?l(L,{src:I,alt:"Icon",width:25}):l("span",{children:t["form.no.icon"]})}),l(c.Item,{field:"iconUrl",children:l(g,{onBlur:e=>{const a=e.target.value;S(a)},placeholder:t["form.iconUrl.placeholder"]})}),l(c.Item,{label:t["form.icon"],field:"icon",triggerPropName:"fileList",children:l(we,{multiple:!0,imagePreview:!0,limit:1,action:"/api/upload/image",listType:"picture-card",isOSS:!1,accept:"image/png,image/jpg,image/jpeg,image/gif,image/webp,image/bmp"})}),l(c.Item,{label:t["form.rating"],field:"rating",children:l(g,{placeholder:t["form.rating.placeholder"]})}),l(c.Item,{label:t["form.sort"],field:"sortIndex",children:l(g,{className:V["arco-input"],placeholder:t["form.sort"]})}),l(c.Item,{label:t["form.status"],field:"status",triggerPropName:"checked",children:l(fe,{})})]})}),l(B,{width:550,title:t["website.detail"],visible:q,onOk:()=>{y(!1)},onCancel:()=>{y(!1)},footer:null,children:l(ge,{colon:"",column:1,labelStyle:{width:100},data:K})})]})}export{Ze as default};
