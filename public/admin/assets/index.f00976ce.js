import{a6 as m,aa as b,r as o,a7 as c,u as se,a as w,j as i,a8 as k,B as D,a9 as re,M as u,ac as le,aT as oe}from"./index.677655a1.js";import"./index.f78dbcd7.js";import{C as ne}from"./index.de1d218d.js";import{C as ce}from"./index.6b254bad.js";import{T as ue}from"./index.b5534811.js";import{P as de}from"./index.be4b26d2.js";import{U as pe}from"./index.aa8ea5c1.js";import{i as me,S as fe,s as L}from"./form.14f536de.js";import{getColumns as he}from"./constants.c8dd49ba.js";import{I as ge}from"./index.b2748c0c.js";import"./b-tween.es.064e2a03.js";import"./index.1b6acd87.js";import"./index.7c19f795.js";import"./index.78d62422.js";function be(n){return m({url:"/website/query",method:"post",data:n})}function Se(){return m({url:"/category/query",method:"post"})}function Ce(n){return m({url:"/website/create",method:"post",data:n})}function xe(n){return m({url:"/website/delete",method:"post",data:n})}function we(n){return m({url:"/website/update",method:"post",data:n})}function ye(n){return m({url:"/website/enable",method:"post",data:n})}function Ie(n){return m({url:"/website/disable",method:"post",data:n})}const Fe=b.Search;function _e(){const[n,W]=o.exports.useState([]),[U,E]=o.exports.useState([]),N=o.exports.useRef(U);N.current=U;const[O,f]=o.exports.useState(!1),[R,S]=o.exports.useState(!1),[y,C]=o.exports.useState(""),[I,F]=o.exports.useState(""),[l]=c.useForm(),a=se(me),[d,V]=o.exports.useState({sizeCanChange:!0,showTotal:!0,pageSize:10,current:1,pageSizeChangeResetCurrent:!0}),[v,_]=o.exports.useState({}),j=async(e,t)=>{if(t=="edit"){C(e.uuid);let s="";s=""+e.icon,e.pid=e.cid;const r=P(e,N.current);r.length!=0&&l.setFieldValue("cid",r),l.setFieldValue("websiteName",e.website_name),l.setFieldValue("url",e.url),l.setFieldValue("sortIndex",e.sort_index),l.setFieldValue("rating",e.rating),l.setFieldValue("description",e.description),l.setFieldValue("status",e.status===1);const h=e.icon?[{uid:e.id,url:s,response:{data:{name:e.icon.replace("/media/image?n=",""),path:e.icon}}}]:[];l.setFieldValue("icon",h),F(e.icon_url),f(!0)}t=="changeStatus"&&(C(e.uuid),H(e.uuid,e.status)),t=="delete"&&G(e.uuid)},q=o.exports.useMemo(()=>he(a,j),[a]),[M,B]=o.exports.useState([]),[J,x]=o.exports.useState(!0),[A,z]=o.exports.useState(!1);o.exports.useEffect(()=>{p()},[d.current,d.pageSize,JSON.stringify(v)]),o.exports.useEffect(()=>{K()},[]);function K(){Se().then(e=>{const t=e.data.list;E(t);const s=$(t);W(s)})}function p(){const{current:e,pageSize:t}=d;x(!0),be({page:e,pageSize:t,...v}).then(s=>{B(s.data.pageData),V({...d,current:e,pageSize:t,total:s.data.total}),x(!1)})}function P(e,t){let s=[];const r=t.find(h=>h.id===e.pid);return r&&(s=[...P(r,t),r.id]),s}function $(e){const t={},s=[];return e.forEach(r=>{t[r.id]={...r,children:[]}}),e.forEach(r=>{var h;if(r.pid!="0"){const g=t[r.pid];g&&(g.label=g.name,g.value=g.id,t[r.id].label=t[r.id].name,t[r.id].value=t[r.id].id,(h=g.children)==null||h.push(t[r.id]))}else t[r.id].label=t[r.id].name,t[r.id].value=t[r.id].id,s.push(t[r.id])}),s}function G(e){x(!0),xe({uuid:e}).then(t=>{t.data.code===0?p():u.error(t.data.message)})}function H(e,t){x(!0),t=="1"?Ie({uuid:e}).then(s=>{s.data.code===0?p():u.error(s.data.message)}):ye({uuid:e}).then(s=>{s.data.code===0?p():u.error(s.data.message)})}function Q(e){z(!0),oe.get("/api/open/website/parse?url="+e).then(t=>{const s=t.data.data;l.setFieldValue("websiteName",s.title),l.setFieldValue("url",s.baseUrl),l.setFieldValue("description",s.description),F(s.icon),z(!1)})}function X(e){return e[e.length-1]}function Y(e){S(!0),e.cid=e.cid==null?0:e.cid,e.cid.length>0&&(e.cid=X(e.cid)),e.icon=e.icon&&e.icon.length!==0?typeof e.icon[0].response=="string"?JSON.parse(e.icon[0].response).data.name:e.icon[0].response.data.name:void 0,e.iconUrl=I,e.status=e.status?"true":"false",y?we({uuid:y,...e}).then(t=>{t.data.code===0?(u.success(a["form.submitSuccess"]),p(),f(!1),T()):u.error(t.data.message),S(!1)}):Ce({...e}).then(t=>{t.data.code===0?(u.success(a["form.submitSuccess"]),f(!1),p(),T()):u.error(t.data.message),S(!1)})}function T(){f(!1),S(!1),l.resetFields()}function Z(){C(""),f(!0),F(""),l.setFieldValue("sortIndex","1")}const ee={labelCol:{span:4},wrapperCol:{span:20}};function te({current:e,pageSize:t}){V({...d,current:e,pageSize:t})}function ae(e){V({...d,current:1}),_(e)}const ie=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5]))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);return w("div",{children:[w(ce,{children:[i(fe,{onSearch:ae,categoryData:n}),i(de,{children:w("div",{className:L["button-group"],children:[i(k,{children:i(D,{onClick:()=>{Z()},type:"primary",children:a["searchTable.operations.add"]})}),i(k,{children:i(D,{onClick:()=>{p()},type:"primary",children:a["searchTable.operations.reload"]})})]})}),i(ue,{rowKey:"id",loading:J,onChange:te,pagination:d,columns:q,data:M})]}),i(re,{width:400,title:y?a["drawer.title.edit"]:a["drawer.title.add"],visible:O,confirmLoading:R,okText:a["form.button.text"],onOk:()=>{l.validate().then(e=>{Y(e)})},onCancel:()=>{C(""),f(!1),S(!1),l.resetFields()},children:w(c,{...ee,form:l,layout:"vertical",children:[i(c.Item,{label:a["form.parseUrl"],field:"parseUrl",children:i(Fe,{placeholder:a["form.parseUrl.placeholder"],searchButton:!0,loading:A,onSearch:e=>{ie(e)?Q(e):u.error(a["form.parseUrl.error"])}})}),i(c.Item,{label:a["form.websiteName"],field:"websiteName",rules:[{required:!0,message:a["form.websiteName.placeholder"]}],children:i(b,{placeholder:a["form.websiteName.placeholder"]})}),i(c.Item,{label:a["form.url"],field:"url",rules:[{required:!0,message:a["form.url.placeholder"]}],children:i(b,{placeholder:a["form.url.placeholder"]})}),i(c.Item,{label:a["form.category"],field:"cid",rules:[{required:!0,message:a["form.category.placeholder"]}],children:i(ne,{placeholder:a["form.category.placeholder"],options:n,changeOnSelect:!0,allowClear:!0})}),i(c.Item,{label:a["form.description"],field:"description",children:i(b.TextArea,{className:L["arco-input"],placeholder:a["form.description.placeholder"]})}),i(c.Item,{label:a["form.icon"],field:"icon",triggerPropName:"fileList",children:i(pe,{multiple:!0,imagePreview:!0,limit:1,action:"/api/upload/image",listType:"picture-card",isOSS:!1,accept:"image/png,image/jpg,image/jpeg,image/gif,image/webp,image/bmp"})}),i(c.Item,{label:a["form.iconUrl"],field:"iconUrl",children:I?i(ge,{src:I,alt:"Icon",width:100}):i("span",{children:a["form.no.icon"]})}),i(c.Item,{label:a["form.rating"],field:"rating",children:i(b,{placeholder:a["form.rating.placeholder"]})}),i(c.Item,{label:a["form.sort"],field:"sortIndex",children:i(b,{className:L["arco-input"],placeholder:a["form.sort"]})}),i(c.Item,{label:a["form.status"],field:"status",triggerPropName:"checked",children:i(le,{})})]})})]})}export{_e as default};
