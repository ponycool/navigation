import{a6 as p,aa as b,r as o,a7 as c,u as se,a as y,j as i,a8 as k,B as D,a9 as re,M as u,ac as le,aT as oe}from"./index.6cf8fee9.js";import"./index.a32ed732.js";import{C as ne}from"./index.176f58f6.js";import{C as ce}from"./index.357af6ae.js";import{T as ue}from"./index.fd488cd8.js";import{P as de}from"./index.b9fd03e7.js";import{U as me}from"./index.5511d112.js";import{i as pe,S as fe,s as L}from"./form.2c6581cb.js";import{getColumns as he}from"./constants.1deeced2.js";import{I as ge}from"./index.01092dbd.js";import"./b-tween.es.064e2a03.js";import"./index.76f01ff0.js";import"./index.83fad488.js";import"./index.e0590a76.js";import"./pad.4b4d3ffd.js";import"./index.b796709e.js";import"./index.b3407620.js";import"./index.dc4a07ba.js";function be(n){return p({url:"/website/query",method:"post",data:n})}function Se(){return p({url:"/category/query",method:"post"})}function Ce(n){return p({url:"/website/create",method:"post",data:n})}function xe(n){return p({url:"/website/delete",method:"post",data:n})}function we(n){return p({url:"/website/update",method:"post",data:n})}function ye(n){return p({url:"/website/enable",method:"post",data:n})}function Ie(n){return p({url:"/website/disable",method:"post",data:n})}const Fe=b.Search;function Me(){const[n,W]=o.exports.useState([]),[U,_]=o.exports.useState([]),N=o.exports.useRef(U);N.current=U;const[E,f]=o.exports.useState(!1),[O,S]=o.exports.useState(!1),[I,C]=o.exports.useState(""),[F,x]=o.exports.useState(""),[l]=c.useForm(),a=se(pe),[d,V]=o.exports.useState({sizeCanChange:!0,showTotal:!0,pageSize:10,current:1,pageSizeChangeResetCurrent:!0}),[z,R]=o.exports.useState({}),j=async(e,t)=>{if(t=="edit"){C(e.uuid);let s="";s=""+e.icon,e.pid=e.cid;const r=T(e,N.current);r.length!=0&&l.setFieldValue("cid",r),l.setFieldValue("websiteName",e.website_name),l.setFieldValue("url",e.url),l.setFieldValue("sortIndex",e.sort_index),l.setFieldValue("iconUrl",e.icon_url),l.setFieldValue("rating",e.rating),l.setFieldValue("description",e.description),l.setFieldValue("status",e.status===1);const h=e.icon?[{uid:e.id,url:s,response:{data:{name:e.icon.replace("/media/image?n=",""),path:e.icon}}}]:[];l.setFieldValue("icon",h),x(e.icon_url),f(!0)}t=="changeStatus"&&(C(e.uuid),H(e.uuid,e.status)),t=="delete"&&G(e.uuid)},q=o.exports.useMemo(()=>he(a,j),[a]),[B,M]=o.exports.useState([]),[J,w]=o.exports.useState(!0),[A,v]=o.exports.useState(!1);o.exports.useEffect(()=>{m()},[d.current,d.pageSize,JSON.stringify(z)]),o.exports.useEffect(()=>{K()},[]);function K(){Se().then(e=>{const t=e.data.list;_(t);const s=$(t);W(s)})}function m(){const{current:e,pageSize:t}=d;w(!0),be({page:e,pageSize:t,...z}).then(s=>{M(s.data.pageData),V({...d,current:e,pageSize:t,total:s.data.total}),w(!1)})}function T(e,t){let s=[];const r=t.find(h=>h.id===e.pid);return r&&(s=[...T(r,t),r.id]),s}function $(e){const t={},s=[];return e.forEach(r=>{t[r.id]={...r,children:[]}}),e.forEach(r=>{var h;if(r.pid!="0"){const g=t[r.pid];g&&(g.label=g.name,g.value=g.id,t[r.id].label=t[r.id].name,t[r.id].value=t[r.id].id,(h=g.children)==null||h.push(t[r.id]))}else t[r.id].label=t[r.id].name,t[r.id].value=t[r.id].id,s.push(t[r.id])}),s}function G(e){w(!0),xe({uuid:e}).then(t=>{t.data.code===0?m():u.error(t.data.message)})}function H(e,t){w(!0),t=="1"?Ie({uuid:e}).then(s=>{s.data.code===0?m():u.error(s.data.message)}):ye({uuid:e}).then(s=>{s.data.code===0?m():u.error(s.data.message)})}function Q(e){v(!0),oe.get("/api/open/website/parse?url="+e).then(t=>{const s=t.data.data;l.setFieldValue("websiteName",s.title),l.setFieldValue("description",s.description),l.setFieldValue("iconUrl",s.icon),x(s.icon),v(!1)})}function X(e){return e[e.length-1]}function Y(e){S(!0),e.cid=e.cid==null?0:e.cid,e.cid.length>0&&(e.cid=X(e.cid)),e.icon=e.icon&&e.icon.length!==0?typeof e.icon[0].response=="string"?JSON.parse(e.icon[0].response).data.name:e.icon[0].response.data.name:void 0,e.iconUrl=F,e.status=e.status?"true":"false",I?we({uuid:I,...e}).then(t=>{t.data.code===0?(u.success(a["form.submitSuccess"]),m(),f(!1),P()):u.error(t.data.message),S(!1)}):Ce({...e}).then(t=>{t.data.code===0?(u.success(a["form.submitSuccess"]),f(!1),m(),P()):u.error(t.data.message),S(!1)})}function P(){f(!1),S(!1),l.resetFields()}function Z(){C(""),f(!0),x(""),v(!1),l.setFieldValue("sortIndex","1")}const ee={labelCol:{span:4},wrapperCol:{span:20}};function te({current:e,pageSize:t}){V({...d,current:e,pageSize:t})}function ae(e){V({...d,current:1}),e.time!=""&&e.time!=null&&(e.startTime=e.time[0],e.endTime=e.time[1],delete e.time),R(e)}const ie=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5]))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);return y("div",{children:[y(ce,{children:[i(fe,{onSearch:ae,categoryData:n}),i(de,{children:y("div",{className:L["button-group"],children:[i(k,{children:i(D,{onClick:()=>{Z()},type:"primary",children:a["searchTable.operations.add"]})}),i(k,{children:i(D,{onClick:()=>{m()},type:"primary",children:a["searchTable.operations.reload"]})})]})}),i(ue,{rowKey:"id",loading:J,onChange:te,pagination:d,columns:q,data:B})]}),i(re,{width:400,title:I?a["drawer.title.edit"]:a["drawer.title.add"],visible:E,confirmLoading:O,okText:a["form.button.text"],onOk:()=>{l.validate().then(e=>{Y(e)})},onCancel:()=>{C(""),f(!1),S(!1),l.resetFields()},children:y(c,{...ee,form:l,layout:"vertical",children:[i(c.Item,{label:a["form.url"],field:"url",rules:[{required:!0,message:a["form.url.placeholder"]}],children:i(Fe,{placeholder:a["form.url.placeholder"],searchButton:!0,loading:A,onSearch:e=>{ie(e)?Q(e):u.error(a["form.parseUrl.error"])}})}),i(c.Item,{label:a["form.websiteName"],field:"websiteName",rules:[{required:!0,message:a["form.websiteName.placeholder"]}],children:i(b,{placeholder:a["form.websiteName.placeholder"]})}),i(c.Item,{label:a["form.category"],field:"cid",rules:[{required:!0,message:a["form.category.placeholder"]}],children:i(ne,{placeholder:a["form.category.placeholder"],options:n,changeOnSelect:!0,allowClear:!0})}),i(c.Item,{label:a["form.description"],field:"description",children:i(b.TextArea,{className:L["arco-input"],placeholder:a["form.description.placeholder"]})}),i(c.Item,{label:a["form.iconUrl"],field:"iconUrl",children:i(b,{onBlur:e=>{const t=e.target.value;x(t)},placeholder:a["form.iconUrl.placeholder"]})}),i(c.Item,{label:a["form.iconUrl.preview"],children:F?i(ge,{src:F,alt:"Icon",width:25}):i("span",{children:a["form.no.icon"]})}),i(c.Item,{label:a["form.icon"],field:"icon",triggerPropName:"fileList",children:i(me,{multiple:!0,imagePreview:!0,limit:1,action:"/api/upload/image",listType:"picture-card",isOSS:!1,accept:"image/png,image/jpg,image/jpeg,image/gif,image/webp,image/bmp"})}),i(c.Item,{label:a["form.rating"],field:"rating",children:i(b,{placeholder:a["form.rating.placeholder"]})}),i(c.Item,{label:a["form.sort"],field:"sortIndex",children:i(b,{className:L["arco-input"],placeholder:a["form.sort"]})}),i(c.Item,{label:a["form.status"],field:"status",triggerPropName:"checked",children:i(le,{})})]})})]})}export{Me as default};
