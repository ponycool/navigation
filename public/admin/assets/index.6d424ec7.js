import{aO as b,r as i,y as n,u as W,a as T,j as o,x as w,B as D,aP as J,z as y,a2 as G,M as c}from"./index.0701407b.js";import{C as H}from"./index.fe066c67.js";import{C as Q}from"./index.3a74b4d9.js";import{T as X}from"./index.f9c32a55.js";import{P as Y}from"./index.71c84a1d.js";import{U as Z}from"./index.166d5954.js";import{getColumns as $}from"./constants.676d1698.js";import"./b-tween.es.064e2a03.js";import"./index.04ef67da.js";import"./index.324d6103.js";import"./index.b2ceac5c.js";import"./index.692427e2.js";import"./index.78cc22b7.js";const ee={"en-US":{"menu.list":"List Page","menu.list.searchTable":"Search Table","searchTable.form.search":"Search","searchTable.form.reset":"Reset","searchTable.columns.id":"ID","searchTable.columns.name":"Name","searchTable.columns.icon":"Icon","searchTable.columns.sort":"Sort","searchTable.columns.updatedTime":"Update time","searchTable.columns.status":"Status","searchTable.columns.status.enable":"Enable","searchTable.columns.status.disable":"Disable","searchTable.columns.operations":"Operations","searchTable.columns.operations.delete":"Delete","searchTable.columns.operations.delete.tip":"Are you sure you want to delete?","searchTable.columns.operations.confirm":"Confirm","searchTable.columns.operations.add":"Create","searchTable.columns.operations.update":"Edit","searchTable.operations.add":"Create","searchTable.operations.reload":"Refresh","searchForm.all.placeholder":"All","searchForm.keyword":"Keyword","searchForm.keyword.placeholder":"Please enter a keyword","drawer.title.edit":"Edit","drawer.title.add":"Create","form.submitSuccess":"Submit Success","form.submitSuccess.error":"Please note that the current node itself cannot be selected in the parent selection","form.button.text":"Save","form.name":"Category Name","form.name.placeholder":"Please enter the category name","form.parent":"Parent Category","form.top":"Root","form.code":"Category Code","form.code.placeholder":"Please enter the category code","form.sort":"Sort","form.icon":"Icon","form.status":"Enable","form.no.icon":"There is no icon for the moment"},"zh-CN":{"menu.list":"\u5217\u8868\u9875","menu.list.searchTable":"\u67E5\u8BE2\u8868\u683C","searchTable.form.search":"\u67E5\u8BE2","searchTable.form.reset":"\u91CD\u7F6E","searchTable.columns.id":"ID","searchTable.columns.name":"\u540D\u79F0","searchTable.columns.icon":"\u56FE\u6807","searchTable.columns.sort":"\u6392\u5E8F","searchTable.columns.updatedTime":"\u66F4\u65B0\u65F6\u95F4","searchTable.columns.status":"\u542F\u7528\u72B6\u6001","searchTable.columns.status.enable":"\u542F\u7528","searchTable.columns.status.disable":"\u7981\u7528","searchTable.columns.operations":"\u64CD\u4F5C","searchTable.columns.operations.delete":"\u5220\u9664","searchTable.columns.operations.delete.tip":"\u4F60\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F","searchTable.columns.operations.confirm":"\u786E\u8BA4","searchTable.columns.operations.add":"\u65B0\u5EFA","searchTable.columns.operations.update":"\u7F16\u8F91","searchTable.operations.add":"\u65B0\u5EFA","searchTable.operations.reload":"\u5237\u65B0","searchForm.all.placeholder":"\u5168\u90E8","searchForm.keyword":"\u5173\u952E\u8BCD","searchForm.keyword.placeholder":"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD","drawer.title.edit":"\u7F16\u8F91","drawer.title.add":"\u65B0\u5EFA","form.submitSuccess":"\u63D0\u4EA4\u6210\u529F","form.submitSuccess.error":"\u8BF7\u6CE8\u610F\uFF0C\u7236\u7EA7\u9009\u62E9\u4E2D\u4E0D\u53EF\u9009\u62E9\u5F53\u524D\u8282\u70B9\u672C\u8EAB","form.button.text":"\u4FDD\u5B58","form.name":"\u5206\u7C7B\u540D\u79F0","form.name.placeholder":"\u8BF7\u586B\u5199\u5206\u7C7B\u540D\u79F0","form.parent":"\u7236\u7EA7\u5206\u7C7B","form.top":"\u6839\u7EA7","form.code":"\u5206\u7C7B\u7F16\u7801","form.code.placeholder":"\u8BF7\u586B\u5199\u5206\u7C7B\u7F16\u7801","form.sort":"\u6392\u5E8F","form.icon":"\u56FE\u6807","form.status":"\u542F\u7528","form.no.icon":"\u6682\u65E0\u56FE\u6807"}},te="_toolbar_1izj9_1",ae="_operations_1izj9_6",re="_gender_1izj9_16",oe="_wrapper_1izj9_23",se="_form_1izj9_29";var E={toolbar:te,operations:ae,"content-type":"_content-type_1izj9_9",gender:re,wrapper:oe,form:se,"form-extra":"_form-extra_1izj9_35","search-form-wrapper":"_search-form-wrapper_1izj9_48","right-button":"_right-button_1izj9_53","button-group":"_button-group_1izj9_62","search-form":"_search-form_1izj9_48"};function ue(){return b({url:"/category/query",method:"post"})}function le(l){return b({url:"/category/create",method:"post",data:l})}function ie(l){return b({url:"/category/delete",method:"post",data:l})}function ne(l){return b({url:"/category/update",method:"post",data:l})}function ce(l){return b({url:"/category/enable",method:"post",data:l})}function me(l){return b({url:"/category/disable",method:"post",data:l})}function Be(){const[l,v]=i.exports.useState([]),[B,I]=i.exports.useState([]),F=i.exports.useRef(B);F.current=B;const[j,m]=i.exports.useState(!1),[V,p]=i.exports.useState(!1),[_,g]=i.exports.useState(""),[u]=n.useForm(),r=W(ee),L=async(e,t)=>{if(t=="add"){g("");const s=S(e,F.current);s.push(e.id),u.setFieldValue("pid",s),u.setFieldValue("sortIndex","1"),m(!0)}if(t=="edit"){g(e.uuid);let s="";s=""+e.icon;const a=S(e,F.current);a.length!=0&&u.setFieldValue("pid",a),u.setFieldValue("name",e.name),u.setFieldValue("id",e.id),u.setFieldValue("code",e.code),u.setFieldValue("sortIndex",e.sort_index),u.setFieldValue("status",e.status===1);const f=e.icon?[{uid:e.id,url:s,response:{data:{name:e.icon.replace("/media/image?n=",""),path:e.icon}}}]:[];u.setFieldValue("icon",f),m(!0)}t=="changeStatus"&&(g(e.uuid),R(e.uuid,e.status)),t=="delete"&&O(e.uuid)},P=i.exports.useMemo(()=>$(r,L),[r]),[k,z]=i.exports.useState([]),[A,C]=i.exports.useState(!0);i.exports.useEffect(()=>{d()},[]);function d(){C(!0),ue().then(e=>{const t=e.data.list===void 0?[]:e.data.list;I(t);const s=N(t);v(s),z(s),C(!1)})}function S(e,t){let s=[];const a=t.find(f=>f.id===e.pid);return a&&(s=[...S(a,t),a.id]),s}function N(e){const t={},s=[];return e.forEach(a=>{t[a.id]={...a,children:[]}}),e.forEach(a=>{var f;if(a.pid!="0"){const h=t[a.pid];h&&(h.label=h.name,h.value=h.id,t[a.id].label=t[a.id].name,t[a.id].value=t[a.id].id,(f=h.children)==null||f.push(t[a.id]))}else t[a.id].label=t[a.id].name,t[a.id].value=t[a.id].id,s.push(t[a.id])}),s}function O(e){C(!0),ie({uuid:e}).then(t=>{t.data.code===0?d():c.error(t.data.message)})}function R(e,t){C(!0),t=="1"?me({uuid:e}).then(s=>{s.data.code===0?d():c.error(s.data.message)}):ce({uuid:e}).then(s=>{s.data.code===0?d():c.error(s.data.message)})}function U(e){return e[e.length-1]}function M(e){if(p(!0),e.pid=e.pid==null?0:e.pid,e.pid.length>0&&(e.pid=U(e.pid)),e.pid==0&&(e.level=1),e.pid!=0)for(const t of F.current)e.pid==t.id&&(e.level=Number(t.level)+1);if(e.icon=e.icon&&e.icon.length!==0?typeof e.icon[0].response=="string"?JSON.parse(e.icon[0].response).data.name:e.icon[0].response.data.name:void 0,e.status=e.status?"true":"false",e.id==e.pid){c.error(r["form.submitSuccess.error"]),p(!1);return}_?ne({uuid:_,...e}).then(t=>{t.data.code===0?(c.success(r["form.submitSuccess"]),d(),m(!1),x()):c.error(t.data.message),p(!1)}):le({...e}).then(t=>{t.data.code===0?(c.success(r["form.submitSuccess"]),m(!1),d(),x()):c.error(t.data.message),p(!1)})}function x(){m(!1),p(!1),u.resetFields()}function q(){g(""),m(!0),u.setFieldValue("sortIndex","1")}const K={labelCol:{span:4},wrapperCol:{span:20}};return T("div",{children:[T(Q,{children:[o(Y,{children:T("div",{className:E["button-group"],children:[o(w,{children:o(D,{onClick:()=>{q()},type:"primary",children:r["searchTable.operations.add"]})}),o(w,{children:o(D,{onClick:()=>{d()},type:"primary",children:r["searchTable.operations.reload"]})})]})}),o(X,{rowKey:"id",loading:A,pagination:!1,columns:P,data:k})]}),o(J,{width:400,title:_?r["drawer.title.edit"]:r["drawer.title.add"],visible:j,confirmLoading:V,okText:r["form.button.text"],onOk:()=>{u.validate().then(e=>{M(e)})},onCancel:()=>{g(""),m(!1),p(!1),u.resetFields()},children:T(n,{...K,form:u,layout:"vertical",children:[o(n.Item,{style:{display:"none"},field:"id",children:o(y,{className:E["arco-input"]})}),o(n.Item,{label:r["form.name"],field:"name",rules:[{required:!0,message:r["form.name.placeholder"]}],children:o(y,{placeholder:r["form.name.placeholder"]})}),o(n.Item,{label:r["form.parent"],field:"pid",children:o(H,{placeholder:r["form.top"],options:l,changeOnSelect:!0,allowClear:!0})}),o(n.Item,{label:r["form.code"],field:"code",children:o(y,{className:E["arco-input"],placeholder:r["form.code.placeholder"]})}),o(n.Item,{label:r["form.icon"],field:"icon",triggerPropName:"fileList",children:o(Z,{multiple:!0,imagePreview:!0,limit:1,action:"/api/upload/image",listType:"picture-card",isOSS:!1,accept:"image/png,image/jpg,image/jpeg,image/gif,image/webp,image/bmp"})}),o(n.Item,{label:r["form.sort"],field:"sortIndex",children:o(y,{className:E["arco-input"],placeholder:r["form.sort"]})}),o(n.Item,{label:r["form.status"],field:"status",triggerPropName:"checked",children:o(G,{})})]})})]})}export{Be as default};
