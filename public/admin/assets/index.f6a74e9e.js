import{r as o,a7 as l,u as O,a as f,j as r,a8 as F,B as v,a9 as _,F as k,aa as m,M as i}from"./index.8245620f.js";import{C as E}from"./index.735bd313.js";import{T as J}from"./index.b970a774.js";import{P as K}from"./index.3faf09b3.js";import{i as W,S as G,s as H}from"./form.ecf55417.js";import{getColumns as Q}from"./constants.ff2028e4.js";import{g as X,d as Y,l as ee,u as ae,a as se,c as re,b as te}from"./index.51e1240a.js";import"./b-tween.es.064e2a03.js";import"./index.3ff74fb3.js";import"./index.e64b27a6.js";import"./index.1fb6f7d0.js";function ge(){const[I,n]=o.exports.useState(!1),[A,p]=o.exports.useState(!1),[N,g]=o.exports.useState(!1),[w,P]=o.exports.useState(!1),[h,S]=o.exports.useState(""),[d]=l.useForm(),e=O(W),[u,x]=o.exports.useState({sizeCanChange:!0,showTotal:!0,pageSize:10,current:1,pageSizeChangeResetCurrent:!0}),[z,Z]=o.exports.useState({}),$=async(a,s)=>{s=="edit"&&(g(!0),S(a.uuid),n(!0),d.setFieldValue("accountName",a.account_name),d.setFieldValue("nickname",a.nickname),d.setFieldValue("email",a.email)),s=="changeStatus"&&L(a.uuid,a.locked),s=="changePassword"&&(g(!0),P(!0),S(a.uuid),n(!0)),s=="delete"&&U(a.uuid)},q=o.exports.useMemo(()=>Q(e,$),[e]),[y,D]=o.exports.useState([]),[T,b]=o.exports.useState(!0);o.exports.useEffect(()=>{c()},[u.current,u.pageSize,JSON.stringify(z)]);function c(){const{current:a,pageSize:s}=u;b(!0),X({page:a,pageSize:s,...z}).then(t=>{D(t.data.pageData),x({...u,current:a,pageSize:s,total:t.data.total}),b(!1)})}function U(a){b(!0),Y({uuid:a}).then(s=>{s.data.code===0?c():i.error(s.data.message)})}function L(a,s){b(!0),s===0?ee({uuid:a}).then(t=>{t.data.code===0?c():i.error(t.data.message)}):ae({uuid:a}).then(t=>{t.data.code===0?c():i.error(t.data.message)})}function V(a){p(!0),h&&!w?se({uuid:h,...a}).then(s=>{s.data.code===0?(i.success(e["form.submitSuccess"]),n(!1),c(),C()):i.error(s.data.message),p(!1)}):h&&w?re({uuid:h,...a}).then(s=>{s.data.code===0?(i.success(e["form.submitSuccess"]),n(!1),c(),C()):i.error(s.data.message),p(!1)}):te({...a}).then(s=>{s.data.code===0?(i.success(e["form.submitSuccess"]),n(!1),c(),C()):i.error(s.data.message),p(!1)})}function C(){n(!1),p(!1),d.resetFields()}function M(){S(""),g(!1),P(!1),n(!0)}const R={labelCol:{span:4},wrapperCol:{span:20}};function j({current:a,pageSize:s}){x({...u,current:a,pageSize:s})}function B(a){x({...u,current:1}),Z(a)}return f("div",{children:[f(E,{children:[r(G,{onSearch:B}),r(K,{children:f("div",{className:H["button-group"],children:[r(F,{children:r(v,{onClick:()=>{M()},type:"primary",children:e["searchTable.operations.add"]})}),r(F,{children:r(v,{onClick:()=>{c()},type:"primary",children:e["searchTable.operations.reload"]})})]})}),r(J,{rowKey:"id",loading:T,onChange:j,pagination:u,columns:q,data:y})]}),r(_,{width:400,title:h?e["drawer.title.edit"]:e["drawer.title.add"],visible:I,confirmLoading:A,okText:e["form.button.text"],onOk:()=>{d.validate().then(a=>{V(a)})},onCancel:()=>{S(""),g(!1),P(!1),n(!1),p(!1),d.resetFields()},children:f(l,{...R,form:d,layout:"vertical",children:[w?"":f(k,{children:[r(l.Item,{label:e["form.accountName"],field:"accountName",rules:[{required:!0,message:e["form.accountName.placeholder"]}],children:r(m,{placeholder:e["form.accountName.placeholder"]})}),r(l.Item,{label:e["form.nickname"],field:"nickname",rules:[{required:!0,message:e["form.nickname.placeholder"]}],children:r(m,{placeholder:e["form.nickname.placeholder"]})}),r(l.Item,{label:e["form.email"],field:"email",rules:[{required:!0,message:e["form.email.placeholder"]},{validator(a,s){/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a)||s(e["form.email.error"])}}],children:r(m,{placeholder:e["form.email.placeholder"]})})]}),w?f(k,{children:[r(l.Item,{label:e["form.oldPassword"],field:"oldPassword",rules:[{required:!0,message:e["form.oldPassword.placeholder"]}],children:r(m.Password,{placeholder:e["form.oldPassword.placeholder"]})}),r(l.Item,{label:e["form.password"],field:"password",rules:[{required:!0,message:e["form.password.placeholder"]},{validator(a,s){/^(?:(?=.*[a-z])(?=.*[A-Z])(?=.*\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=])|(?=.*[a-z])(?=.*\d)(?=.*[@#$%^&+=])|(?=.*[A-Z])(?=.*\d)(?=.*[@#$%^&+=])).{6,18}$/.test(a)||s(e["form.password.error"])}}],children:r(m.Password,{placeholder:e["form.password.placeholder"]})}),r(l.Item,{label:e["form.confirmPassword"],field:"confirmPassword",rules:[{required:!0,message:e["form.confirmPassword.placeholder"]},{validator(a,s){const t=d.getFieldValue("password");a!==t&&s(e["form.passwordsDoNotMatch"])}}],children:r(m.Password,{placeholder:e["form.password.placeholder"]})})]}):"",N?"":f(k,{children:[r(l.Item,{label:e["form.password"],field:"password",rules:[{required:!0,message:e["form.password.placeholder"]},{validator(a,s){/^(?:(?=.*[a-z])(?=.*[A-Z])(?=.*\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=])|(?=.*[a-z])(?=.*\d)(?=.*[@#$%^&+=])|(?=.*[A-Z])(?=.*\d)(?=.*[@#$%^&+=])).{6,18}$/.test(a)||s(e["form.password.error"])}}],children:r(m.Password,{placeholder:e["form.password.placeholder"]})}),r(l.Item,{label:e["form.confirmPassword"],field:"confirmPassword",rules:[{required:!0,message:e["form.confirmPassword.placeholder"]},{validator(a,s){const t=d.getFieldValue("password");a!==t&&s(e["form.passwordsDoNotMatch"])}}],children:r(m.Password,{placeholder:e["form.password.placeholder"]})})]})]})})]})}export{ge as default};
